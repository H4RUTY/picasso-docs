---
title: 'REST API ä»•æ§˜æ›¸'
---

<br />

<Callout title="å½“ä»•æ§˜æ›¸ã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆAI ã«æŠ•ã’ã‚‹ç”¨ï¼‰" type="success">
  ä»¥ä¸‹ã‚’ã‚³ãƒ”ãƒšã™ã‚Œã°ã€API è¨­è¨ˆã‚’ AI ã«æŠ•ã’ã‚‹éš›ã«ä¾¿åˆ©ã§ã™ã€‚ <br />
  [ã“ã®ä»•æ§˜æ›¸ã®ãƒ•ã‚¡ã‚¤ãƒ«](https://github.com/H4RUTY/picasso-docs/blob/main/content/docs/developers/api-design.mdx?plain=1)
  ğŸ‘ˆ Click This!!
</Callout>

---

## 0. è¨­è¨ˆæ€æƒ³

æœ¬ API ã¯ã€Œ**state.json ã‚’å”¯ä¸€ã®çœŸå®Ÿï¼ˆSingle Source of Truthï¼‰ã¨ã™ã‚‹**ã€ã“ã¨ã‚’åŸºæœ¬æ–¹é‡ã¨ã—ã¾ã™ã€‚
ã™ã¹ã¦ã®çŠ¶æ…‹ã¯ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é€šã˜ã¦ç®¡ç†ãƒ»å…±æœ‰ã•ã‚Œã€ã‚µãƒ¼ãƒãƒ»ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆé–“ã§ä¸€è²«ã—ã¦æ‰±ã‚ã‚Œã¾ã™ã€‚

- **çŠ¶æ…‹ã®ä¸€å…ƒç®¡ç†**

  - ã‚²ãƒ¼ãƒ ã®çŠ¶æ…‹ã¯ã™ã¹ã¦ `state.json` ã«é›†ç´„ã—ã€ã‚µãƒ¼ãƒãŒæ­£ã¨ã—ã¦æ‰±ã†ã€‚
  - æ›´æ–°ç³» APIï¼ˆ`capture`, `analyze`, `next`, `advance`, `end`ãªã©ï¼‰ã¯ã€æ›´æ–°å¾Œã® `state.json` å…¨ä½“ã‚’è¿”ã™ã€‚

- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¨ã®é–¢ä¿‚**
  - ãƒ•ãƒ­ãƒ³ãƒˆã¯ `state.json` ã®ã‚³ãƒ”ãƒ¼ã‚’ä¿æŒã—ã€UI è¡¨ç¤ºç”¨ã«éšæ™‚æ›´æ–°ã™ã‚‹ã€‚
  - API å‘¼ã³å‡ºã—å¾Œã€è¿”å´ã•ã‚ŒãŸæœ€æ–°ã® `state.json` ã‚’åæ˜ ã—ã¦åŒæœŸã‚’ä¿ã¡ã€ã‚µãƒ¼ãƒã¨åŒä¸€ã®çŠ¶æ…‹ã‚’å†ç¾ã™ã‚‹ã€‚

---

## 1. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```text
/app-root
 â”œâ”€ games/
 â”‚   â”œâ”€ 20251007-192416/           # gameId = YYYYMMDD-HHMMSS
 â”‚   â”‚   â”œâ”€ state.json
 â”‚   â”‚   â”œâ”€ turn-1.png
 â”‚   â”‚   â”œâ”€ turn-2.png
 â”‚   â”‚   â”œâ”€ svg/
 â”‚   â”‚   â”‚  â”œâ”€ turn-2.svg
 â”‚   â”‚   â”‚  â””â”€ turn-4.svg
 â”‚   â”‚   â””â”€ gcode/
 â”‚   â”‚      â”œâ”€ turn-2.gcode
 â”‚   â”‚      â””â”€ turn-4.gcode
 â”‚   â””â”€ 20251008-103029/
 â”‚       â””â”€ ...
 â”œâ”€ uploads/                       # ï¼ˆä»»æ„ï¼‰ä¸€æ™‚ä¿å­˜ç”¨
 â”œâ”€ logs/
 â””â”€ config/
```

- `gameId` ã¯ `YYYYMMDD-HHMMSS` å½¢å¼ã€‚
- `games/:gameId/state.json` ãŒãã®ã‚²ãƒ¼ãƒ ã® SOTï¼ˆsource of truthï¼‰ã€‚

---

## 2. state.json ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

### ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰

- `gameId` (string)
- `firstActor` ("user" | "ai")
- `turn` (integer) â€” æœ€æ–°ã‚¿ãƒ¼ãƒ³ç•ªå·
- `status` ("created" | "playing" | "finished" | "aborted")
- `result` ("ai-win" | "user-win" | "draw" | null)
- `history` (array of entries)

  - entry:

    - `actor` ("user" | "ai")
    - `word` (string | null)
    - `image` (string | null) â€” ç›¸å¯¾ãƒ‘ã‚¹ï¼ˆä¾‹: `turn-3.png`ï¼‰

### ä¾‹

```json
{
  "gameId": "20251007-192416",
  "firstActor": "user",
  "turn": 3,
  "status": "playing",
  "result": null,
  "history": [
    {
      "actor": "user",
      "word": "ã‚Šã‚“ã”",
      "image": "turn-1.png"
    },
    {
      "actor": "ai",
      "word": "ã‚´ãƒªãƒ©",
      "image": "turn-2.png"
    },
    {
      "actor": "user",
      "word": null,
      "image": "turn-3.png"
    }
  ]
}
```

---

## 3. API ä¸€è¦§ï¼ˆæ¦‚è¦ï¼‰

| ãƒ¡ã‚½ãƒƒãƒ‰ | ãƒ‘ã‚¹                            | æ¦‚è¦                                                             |
| -------- | ------------------------------- | ---------------------------------------------------------------- |
| POST     | `/games`                        | æ–°è¦ã‚²ãƒ¼ãƒ ä½œæˆï¼ˆgameId ç™ºè¡Œã€state.json ç”Ÿæˆï¼‰                   |
| GET      | `/games`                        | éå»ã‚²ãƒ¼ãƒ ä¸€è¦§å–å¾—ï¼ˆgameId, startedAt, result, summaryï¼‰         |
| GET      | `/games/:gameId`                | ã‚²ãƒ¼ãƒ çŠ¶æ…‹å–å¾—ï¼ˆstate.json ã‚’è¿”ã™ï¼‰                              |
| PATCH    | `/games/:gameId`                | state.json ã®éƒ¨åˆ†æ›´æ–°ï¼ˆç®¡ç†ç”¨ï¼‰                                  |
| POST     | `/games/:gameId/slide`          | ãƒ­ãƒ¼ãƒ«ç´™ã‚’æŒ‡å®šé•·ã•ï¼ˆmmï¼‰ã ã‘é€ã‚‹ï¼ˆéåŒæœŸã€‚202 Acceptedï¼‰         |
| GET      | `/games/:gameId/slide/:jobId`   | ãƒ­ãƒ¼ãƒ«ç´™ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¸ãƒ§ãƒ–ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å–å¾—                             |
| POST     | `/games/:gameId/capture`        | Web ã‚«ãƒ¡ãƒ©ã§æ’®å½±ã— turn-N.png ã‚’ä¿å­˜                             |
| POST     | `/games/:gameId/turn/advance`   | ã‚¿ãƒ¼ãƒ³ã‚’æ¬¡ã«é€²ã‚ã‚‹                                               |
| POST     | `/games/:gameId/ai/analyze`     | ãƒ¦ãƒ¼ã‚¶ã®ç”»åƒè§£æ â†’ å˜èªæ¨æ¸¬ â†’ å‹æ•—åˆ¤å®š                           |
| POST     | `/games/:gameId/ai/next`        | AI ã§æ¬¡ã®å˜èªç”Ÿæˆ â†’ å‹æ•—åˆ¤å®š                                     |
| POST     | `/games/:gameId/ai/plot`        | AI SVG ç”Ÿæˆ â†’ G-code å¤‰æ› â†’ ãƒ—ãƒ­ãƒƒã‚¿é€ä¿¡ï¼ˆéåŒæœŸã€‚202 Acceptedï¼‰ |
| GET      | `/games/:gameId/ai/plot/:jobId` | æç”»ã‚¸ãƒ§ãƒ–ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å–å¾—                                         |
| POST     | `/games/:gameId/ai/hint`        | å˜èªã®ãƒ’ãƒ³ãƒˆç”Ÿæˆ                                                 |
| POST     | `/games/:gameId/end`            | å¼·åˆ¶çµ‚äº†ï¼ˆresult = "draw" ã‚’ã‚»ãƒƒãƒˆï¼‰                             |

---

## 4. å„ API ã®è©³ç´°ä»•æ§˜

### POST /games

**èª¬æ˜**: æ–°è¦ã‚²ãƒ¼ãƒ ã‚’ä½œæˆã™ã‚‹ã€‚

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**

```json
{ "firstActor": "user" }
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**
`201 Created` ãƒ» `state.json`

**å‰¯ä½œç”¨**: `games/:gameId` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨åˆæœŸ `state.json` ã‚’ä½œæˆã€‚

---

### GET /games

**èª¬æ˜**: ã™ã¹ã¦ã® `games/*/state.json` ã‚’å‚ç…§ã—ã¦ç°¡æ˜“ä¸€è¦§ã‚’è¿”ã™ã€‚

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**
`200 OK`

```json
[
  { "gameId": "20251007-192416", "result": "draw" },
  { "gameId": "20251008-103029", "result": "ai-win" }
]
```

---

### GET /games/:gameId

**èª¬æ˜**: `state.json` ã‚’è¿”ã™ã€‚

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: `200 OK` ãƒ» `state.json`

---

### PATCH /games/:gameId

**èª¬æ˜**: ç®¡ç†ç”¨ã®éƒ¨åˆ†æ›´æ–°ï¼ˆä¾‹: `status`, `result` ã‚’ã‚»ãƒƒãƒˆï¼‰ã€‚

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**

```json
{ "status": "finished", "result": "user-win" }
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: `200 OK` ãƒ» `state.json`

---

### POST /games/:gameId/slide

**èª¬æ˜**: ãƒ­ãƒ¼ãƒ«ç´™ã‚’æŒ‡å®šé•·ã•ã ã‘é€ã‚‹ã€‚å‡¦ç†ã¯éåŒæœŸã€‚

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**

```json
{ "length": 100 }
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**
`202 Accepted`

```json
{
  "status": "accepted",
  "jobId": "job-20251007-192416-slide-100",
  "message": "Sliding started."
}
```

**æ³¨æ„**: ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢é€šä¿¡ã‚¨ãƒ©ãƒ¼ã¯ `503` ã‚’è¿”ã™ã€‚

---

### GET /games/:gameId/slide/:jobId

**èª¬æ˜**: ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¸ãƒ§ãƒ–ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å–å¾—

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**

```json
{
  "jobId": "job-20251007-192416-slide-100",
  "status": "sliding"
}
```

<Callout title="statusã®å†…å®¹" type="info">
  `pending` : å¾…ã¡

`sliding` ãƒ­ãƒ¼ãƒ«ç´™ã‚¹ãƒ©ã‚¤ãƒ‰ä¸­

`done` : å…¨å·¥ç¨‹ãŒå®Œäº†

`error` : ã„ãšã‚Œã‹ã®å·¥ç¨‹ã§å¤±æ•—

</Callout>

---

### POST /games/:gameId/capture

**èª¬æ˜**: ã‚«ãƒ¡ãƒ©ã§æ’®å½±ã— `turn-N.png` ã‚’ä¿å­˜ã€`history` ã® `image` ã‚’æ›´æ–°ã€‚

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**

ãªã—ï¼ˆãƒœãƒ‡ã‚£ä¸è¦ï¼‰

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**
`201 Created` ãƒ» `state.json`

---

### POST /games/:gameId/turn/advance

**èª¬æ˜**: ã‚¿ãƒ¼ãƒ³ã‚’é€²ã‚ã‚‹ã€‚

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**

ãªã—ï¼ˆãƒœãƒ‡ã‚£ä¸è¦ï¼‰

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**
`200 OK` ãƒ» `state.json`

**å†…éƒ¨ã®æµã‚Œ**:

1. turn ã‚’ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã™ã‚‹ã€‚
2. history[] ã«æ–°ãŸãªã‚¨ãƒ³ãƒˆãƒªã‚’è¿½åŠ ã™ã‚‹ã€‚ï¼ˆ `word`, `image` ã¯ nullï¼‰

   ```json
   // ä¾‹

   "history": [
    ...,
    {
      "actor": "user",
      "word": null,
      "image": null
    }
   ]
   ```

---

### POST /games/:gameId/ai/analyze

**èª¬æ˜**: æœ€æ–°ç”»åƒã‚’ AI è§£æã—ã¦å˜èªã‚’æ¨æ¸¬ã€å‹æ•—ã‚’åˆ¤å®šã™ã‚‹ã€‚

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**

ãªã—ï¼ˆãƒœãƒ‡ã‚£ä¸è¦ï¼‰

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**
`200 OK` ãƒ» `state.json`

**å†…éƒ¨ã®æµã‚Œ**:

1. æœ€æ–° `turn-N.png` ã‚’è§£æã—ã¦å˜èªã‚’è§£æã™ã‚‹
2. `analyzedWord` ãŒ `ã‚“` ã§çµ‚ã‚ã‚Œã°ãƒ¦ãƒ¼ã‚¶æ•—åŒ— â†’ `result: "ai-win"` , `status: finished` ã‚’ã‚»ãƒƒãƒˆ

---

### POST /games/:gameId/ai/next

**èª¬æ˜**: AI ã§æ¬¡ã®å˜èªã‚’ç”Ÿæˆã—ã€AI ãŒç”Ÿæˆã—ãŸå˜èªã®å‹æ•—åˆ¤å®š

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**

ãªã—ï¼ˆãƒœãƒ‡ã‚£ä¸è¦ï¼‰

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**

`201 Created` ãƒ» `state.json`

**å†…éƒ¨ã®æµã‚Œ**:

1. ç›´å‰ã®ãƒ¦ãƒ¼ã‚¶ã®å˜èªã‚’å…ƒã«æ–°å˜èªç”Ÿæˆ
2. ç”Ÿæˆã•ã‚ŒãŸå˜èª ãŒ `ã‚“` ã§çµ‚ã‚ã‚Œã° AI æ•—åŒ— â†’ `result: "user-win"` , `status: finished` ã‚’ã‚»ãƒƒãƒˆ

---

### POST /games/:gameId/ai/plot

**èª¬æ˜**: æŒ‡å®šå˜èªã‚’ SVG åŒ– â†’G-code åŒ– â†’ ãƒ—ãƒ­ãƒƒã‚¿ã¸é€ä¿¡ã—ã¦æç”»ã‚’é–‹å§‹ã™ã‚‹ã€‚å‡¦ç†ã¯éåŒæœŸã€‚

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**

```json
{ "word": "ã”ã‚Šã‚‰" }
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**
`202 Accepted`

```json
{
  "status": "accepted",
  "jobId": "job-20251007-192416-plot-1",
  "message": "Plotting started."
}
```

**å‰¯ä½œç”¨ï¼ˆéåŒæœŸãƒ¯ãƒ¼ã‚«ãƒ¼ï¼‰**

- SVG ä¿å­˜ â†’ G-code ä¿å­˜ â†’ Grbl ã¸é€ä¿¡

---

### GET /games/:gameId/ai/plot/:jobId

**èª¬æ˜**: æç”»ã‚¸ãƒ§ãƒ–ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å–å¾—

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**

```json
{
  "jobId": "job-20251007-192416-plot-1",
  "status": "plotting"
}
```

<Callout title="statusã®å†…å®¹" type="info">
  `svg_generating` : svgç”Ÿæˆä¸­

`plotting` G-code å¤‰æ› â†’ ãƒ—ãƒ­ãƒƒã‚¿æç”»ä¸­

`done` : å…¨å·¥ç¨‹ãŒå®Œäº†

`error` : ã„ãšã‚Œã‹ã®å·¥ç¨‹ã§å¤±æ•—

</Callout>

---

### POST /games/:gameId/ai/hint

**èª¬æ˜**: å˜èªã®ãƒ’ãƒ³ãƒˆã‚’ç”Ÿæˆã—ã¦è¿”ã™

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**

```json
{ "word": "ã¼ãŸã‚“" } /* ã€Œã‚“ã€ã§çµ‚ã‚ã£ã¦ã€ã‚²ãƒ¼ãƒ çµ‚äº†ã‚„ãªã„ã‹ã„ï¼ */
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**

```json
{ "hint": "æ˜¥ã«å’²ãèŠ±ã§ã€èŠ±å¼ãŒå¤§ããè¯ã‚„ã‹ã§ã™ã€‚" } /* ãã£ã¡ã®ã¼ãŸã‚“ã‹ã„ï¼ */
```

---

### POST /games/:gameId/end

**èª¬æ˜**: å¼·åˆ¶çµ‚äº†ï¼ˆUI ã®ã€Œã‚²ãƒ¼ãƒ çµ‚äº†ã€ãƒœã‚¿ãƒ³ï¼‰ã€‚`result` ã‚’ `"draw"` ã«ã—ã¦ `status` ã‚’ `"finished"` ã«æ›´æ–°ã™ã‚‹ã€‚

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**: çœç•¥å¯ï¼ˆä»»æ„ã§ reason ã‚’é€ã‚Œã‚‹ï¼‰

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**
`200 OK` ãƒ» `state.json`

**å‰¯ä½œç”¨**: å®Ÿè¡Œä¸­ã‚¸ãƒ§ãƒ–ãŒã‚ã‚Œã°åœæ­¢å‘½ä»¤ã‚’è©¦è¡Œï¼ˆå¯èƒ½ãªã‚‰ hardware å´ã®åœæ­¢ã‚’å‘¼ã³å‡ºã™ï¼‰ã€‚

---

## 5. ï¼ˆâš ï¸ æ³¨æ„ï¼‰ state.json æ›´æ–°ã®åˆ†æ‹…ã«ã¤ã„ã¦

å„ API ã¯ã€ `state.json` ã®ã†ã¡ã©ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æ›´æ–°ã™ã‚‹ã‹æ˜ç¢ºã«åˆ†æ‹…ã•ã‚Œã¦ã„ã¾ã™ã€‚
ã“ã®åˆ†æ‹…ã«å¾“ã†ã“ã¨ã§ã€ã‚µãƒ¼ãƒãƒ»ãƒ•ãƒ­ãƒ³ãƒˆé–“ã§å¸¸ã«æ•´åˆæ€§ã®å–ã‚ŒãŸçŠ¶æ…‹ã‚’ç¶­æŒã—ã¾ã™ã€‚

- **`turn` ã®ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆ, `history[]` ã‚¨ãƒ³ãƒˆãƒªã®æ–°è¦ä½œæˆ**:

  - `/turn/advance` ãŒè¡Œã„ã¾ã™ã€‚<br/>

- **`history[]` ä¸­ã® `word` ã®æ›´æ–°**:

  - ãƒ¦ãƒ¼ã‚¶ã®ã‚¿ãƒ¼ãƒ³ã§ã¯ `/ai/analyze` ãŒè¡Œã„ã¾ã™ã€‚
  - AI ã®ã‚¿ãƒ¼ãƒ³ã§ã¯ `/ai/next` ãŒè¡Œã„ã¾ã™ã€‚

- **`history[]` ä¸­ã® `image` ã®æ›´æ–°**:

  - `/capture` ãŒè¡Œã„ã¾ã™ã€‚

---

### ã‚¿ãƒ¼ãƒ³åˆ¥ã®æ›´æ–°ã‚·ãƒ¼ã‚±ãƒ³ã‚¹

#### ãƒ¦ãƒ¼ã‚¶ã®ã‚¿ãƒ¼ãƒ³

1. ã‚²ãƒ¼ãƒ é–‹å§‹  
   `POST /games`

```diff
+ {
+   "gameId": "20251007-192416",
+   "firstActor": "user",
+   "turn": 0,
+   "status": "playing",
+   "result": null,
+   "history": []
+ }
```

2. `turn++` ã€æ–°è¦ã‚¨ãƒ³ãƒˆãƒªè¿½åŠ   
   `POST /turn/advance`

```diff
  {
    "gameId": "20251007-192416",
    "firstActor": "user",
-   "turn": 0,
+   "turn": 1,
    "status": "playing",
    "result": null,
    "history": [
+     {
+       "actor": "user",
+       "word": "null",
+       "image": "null"
+     }
    ]
  }
```

3. `image` æ›´æ–°  
   `POST /capture`

```diff
  {
    "gameId": "20251007-192416",
    "firstActor": "user",
    "turn": 1,
    "status": "playing",
    "result": null,
    "history": [
      {
        "actor": "user",
        "word": null,
-       "image": null
+       "image": "turn-1.png"
      }
    ]
  }
```

4. `word` è¿½åŠ   
   `POST /ai/analyze`

```diff
  {
    "gameId": "20251007-192416",
    "firstActor": "user",
    "turn": 1,
    "status": "playing",
    "result": null,
    "history": [
      {
        "actor": "user",
-       "word": null,
+       "word": "ã‚Šã‚“ã”",
        "image": "turn-1.png"
      }
    ]
  }
```

5. AI ã®ã‚¿ãƒ¼ãƒ³ã¸ç§»è¡Œ

<br />

#### AI ã®ã‚¿ãƒ¼ãƒ³

1. ã‚²ãƒ¼ãƒ é–‹å§‹  
   `POST /games`

```diff
+ {
+   "gameId": "20251007-192416",
+   "firstActor": "ai",
+   "turn": 0,
+   "status": "playing",
+   "result": null,
+   "history": []
+ }
```

2. `turn++` ã€æ–°è¦ã‚¨ãƒ³ãƒˆãƒªè¿½åŠ   
   `POST /turn/advance`

```diff
  {
    "gameId": "20251007-192416",
    "firstActor": "ai",
-   "turn": 0,
+   "turn": 1,
    "status": "playing",
    "result": null,
    "history": [
+     {
+       "actor": "ai",
+       "word": "null",
+       "image": "null"
+     }
    ]
  }
```

3. `word` è¿½åŠ ï¼ˆAI ãŒæ€è€ƒï¼‰  
   `POST /ai/next`

```diff
  {
    "gameId": "20251007-192416",
    "firstActor": "ai",
    "turn": 1,
    "status": "playing",
    "result": null,
    "history": [
      {
        "actor": "ai",
-       "word": null,
+       "word": "ã‚Šã‚“ã”",
        "image": null
      }
    ]
  }
```

4. `image` æ›´æ–°ï¼ˆãƒ—ãƒ­ãƒƒã‚¿æç”»å¾Œï¼‰  
   `POST /capture`

```diff
  {
    "gameId": "20251007-192416",
    "firstActor": "ai",
    "turn": 1,
    "status": "playing",
    "result": null,
    "history": [
      {
        "actor": "ai",
        "word": "ã‚Šã‚“ã”",
-       "image": null
+       "image": "turn-1.png"
      }
    ]
  }
```

5. ãƒ¦ãƒ¼ã‚¶ ã®ã‚¿ãƒ¼ãƒ³ã¸ç§»è¡Œ

---

### ã¾ã¨ã‚ï¼ˆã‚¿ãƒ¼ãƒ³é€²è¡Œã®åŸå‰‡ï¼‰

| ã‚¿ãƒ¼ãƒ³     | æ‰‹é †                                              | API å‘¼ã³å‡ºã—é †åº                             | æ›´æ–°å¯¾è±¡                |
| ---------- | ------------------------------------------------- | -------------------------------------------- | ----------------------- |
| **ãƒ¦ãƒ¼ã‚¶** | 1ï¸âƒ£ ã‚¿ãƒ¼ãƒ³ã‚’é€²ã‚ã‚‹ â†’ 2ï¸âƒ£ ç”»åƒã‚’å–å¾— â†’ 3ï¸âƒ£ å˜èªã‚’è§£æ | `/turn/advance` â†’ `/capture` â†’ `/ai/analyze` | `turn`, `image`, `word` |
| **AI**     | 1ï¸âƒ£ ã‚¿ãƒ¼ãƒ³ã‚’é€²ã‚ã‚‹ â†’ 2ï¸âƒ£ å˜èªã‚’ç”Ÿæˆ â†’ 3ï¸âƒ£ ç”»åƒã‚’å–å¾— | `/turn/advance` â†’ `/ai/next` â†’ `/capture`    | `turn`, `word`, `image` |

---

## 6. TypeScript å‹å®šç¾©

ä»¥ä¸‹ã¯å®Ÿè£…æ™‚ã«ä½¿ãˆã‚‹ TypeScript ã®å‹å®šç¾©ã§ã™ã€‚

```typescript
// types.ts

// =================
//       åŸºæœ¬å½¢
// =================

export type Actor = 'user' | 'ai';
export type GameStatus = 'created' | 'playing' | 'finished' | 'aborted';
export type GameResult = 'ai-win' | 'user-win' | 'draw' | null;

export interface HistoryEntry {
  actor: Actor;
  word: string | null;
  image: string | null; // ç›¸å¯¾ãƒ‘ã‚¹ e.g. "turn-3.png"
}

export interface GameState {
  gameId: string; // YYYYMMDD-HHMMSS
  firstActor: Actor;
  turn: number; // æœ€æ–°ã‚¿ãƒ¼ãƒ³ç•ªå·
  status: GameStatus;
  result: GameResult; // "ai-win" | "user-win" | "draw" | null
  history: HistoryEntry[];
}

// =================
//        API
// =================

// POST /games
export interface CreateGameRequest {
  firstActor: Actor;
}
export type CreateGameResponse = GameState;

// GET /games (ä¸€è¦§ã®å„è¦ç´ )
export interface GamesListItem {
  gameId: string;
  result: GameResult;
}

// GET /games/:gameId
export type GetGameStateResponse = GameState;

// PATCH /games/:gameId
export interface PatchGameRequest {
  status?: GameStatus;
  result?: GameResult;
  // ä»–ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚‚éƒ¨åˆ†æ›´æ–°å¯èƒ½ã«ã™ã‚‹å ´åˆã¯è¿½åŠ 
}
export type PatchGameResponse = GameState;

// POST /games/{gameId}/slide
export interface SlideRequest {
  length: number; // mm
}
export interface SlideResponse {
  status: 'accepted' | 'error';
  jobId?: string;
  message?: string;
}

// GET /games/{gameId}/slide/{jobId}
export type SlideJobStatus = 'pending' | 'sliding' | 'done' | 'error';
export interface SlideJobResponse {
  jobId: string;
  status: SlideJobStatus;
}

// POST /games/{gameId}/capture
export type CaptureResponse = GameState;

// POST /games/{gameId}/turn/advance
export type AdvanceTurnResponse = GameState;

// POST /games/{gameId}/ai/analyze
export type AnalyzeResponse = GameState;

// POST /games/{gameId}/ai/next
export type NextResponse = GameState;

// POST /games/{gameId}/ai/plot
export interface PlotRequest {
  word: string;
}
export interface PlotResponse {
  status: 'accepted' | 'error';
  jobId?: string;
  message?: string;
}

// GET /games/{gameId}/ai/plot/{jobId}
export type PlotJobStatus = 'svg_generating' | 'plotting' | 'done' | 'error';
export interface PlotJobResponse {
  jobId: string;
  status: PlotJobStatus;
}

// POST /games/{gameId}/ai/hint
export interface HintRequest {
  word: string;
}
export interface HintResponse {
  hint: string;
}

// POST /games/{gameId}/end
export type EndResponse = GameState;
```

<br />
